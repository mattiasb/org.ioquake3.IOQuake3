app-id: org.ioquake3.IOQuake3
runtime: org.freedesktop.Platform
runtime-version: '22.08'
sdk: org.freedesktop.Sdk
command: ioquake3
rename-desktop-file: ioquake3.desktop
rename-icon: quake3
finish-args:
  - --device=dri
  - --share=network
  - --socket=pulseaudio
  - --socket=fallback-x11
  - --socket=wayland
  - --persist=.q3a

modules:
  - name: ioquake3
    buildsystem: simple
    build-commands:
      - BUILD_SERVER=0 COPYDIR=/app/share/ioquake3 make -j $FLATPAK_BUILDER_N_JOBS copyfiles
      - >-
        install
        -Dm644 misc/quake3.svg
        -t /app/share/icons/hicolor/scalable/apps/
      - >-
        install
        -Dm644 misc/setup/ioquake3.desktop
        -t /app/share/applications/
    sources:
      - type: git
        url: https://github.com/ioquake/ioq3.git
        commit: 10a45cbdc131a35530d89bd3cfc2a7eed74b54cc

  - name: ioquake3-launcher
    buildsystem: simple
    build-commands:
      - install -Dm 744 ioquake3 -t /app/bin
    sources:
      # ioquake3 launcher script that:
      # - … makes ~/.q3a/ available at ~/.var/app/org.ioquake3.IOQuake3/data/
      # - … explains (via zenity) where the user can put configs and pk3-files.
      - type: file
        path: ioquake3

  - name: ioquake3-metainfo
    buildsystem: simple
    build-commands:
      - install -Dm 644 org.ioquake3.IOQuake3.metainfo.xml -t /app/share/metainfo
    sources:
      - type: file
        path: org.ioquake3.IOQuake3.metainfo.xml
